{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/helmholtz-munich/pipeline_digital_karyotyping/main/nextflow.schema.json",
    "title": "KaryoExplorer - Digital Karyotyping Pipeline",
    "description": "Comprehensive Nextflow pipeline for digital karyotyping analysis of Illumina genotyping array data, including CNV detection, ROH analysis, and interactive visualization. Supports both single-sample and paired (PRE/POST) analysis modes.",
    "type": "object",
    "definitions": {
        "input_output_options": {
            "title": "Input/output options",
            "type": "object",
            "description": "Define where the pipeline should find input data and save output data.",
            "required": [],
            "properties": {
                "project_ID": {
                    "type": "string",
                    "description": "Project identifier for tracking and organization.",
                    "help_text": "Unique identifier for your project (e.g., P25101).",
                    "fa_icon": "fas fa-id-card"
                },
                "responsible_person": {
                    "type": "string",
                    "description": "Name of the person responsible for the analysis.",
                    "help_text": "Name of the requester or principal investigator.",
                    "fa_icon": "fas fa-user"
                },
                "samples_refs": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to sample pairing file (XLS/TSV format).",
                    "help_text": "Sample pairing file with 'Sample' and 'Reference' columns. Run preprocessing/preprocessing_run.sh to generate in XLS format.",
                    "fa_icon": "fas fa-file-excel"
                },
                "manifest": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to Illumina array manifest file (CSV format).",
                    "help_text": "Illumina manifest file containing SNP probe information and genomic coordinates from GSA-MD-48v4-0_Manifest_Files.",
                    "fa_icon": "fas fa-file-csv"
                },
                "gsplink": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "Path to PLINK files directory.",
                    "help_text": "Directory containing PLINK format files (.ped and .map) exported from GenomeStudio (e.g., PLINK_<Date>_<Time>).",
                    "fa_icon": "fas fa-folder"
                },
                "PAR": {
                    "type": "string",
                    "format": "file-path", 
                    "description": "Path to PAR coordinate file (GRCh37 or GRCh38).",
                    "help_text": "File containing pseudoautosomal region coordinates. Choose PAR_Coord_GRCh37.txt or PAR_Coord_GRCh38.txt to match your reference genome.",
                    "fa_icon": "fas fa-map-marker-alt"
                },
                "fullTable": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to GenomeStudio Full Data Table export (TXT).",
                    "help_text": "Complete SNP data table exported from GenomeStudio containing LRR and BAF values for all samples.",
                    "fa_icon": "fas fa-table"
                },
                "samplesTable": {
                    "type": "string", 
                    "format": "file-path",
                    "description": "Path to GenomeStudio Samples Table export (TXT).",
                    "help_text": "Sample metadata table exported from GenomeStudio containing QC metrics and sample information.",
                    "fa_icon": "fas fa-users"
                },
                "snpTable": {
                    "type": "string",
                    "format": "file-path", 
                    "description": "Path to GenomeStudio SNP Table export (TXT).",
                    "help_text": "SNP annotation table exported from GenomeStudio with genomic positions and allele information.",
                    "fa_icon": "fas fa-dna"
                },
                "outdir": {
                    "type": "string",
                    "format": "directory-path",
                    "description": "The output directory where the results will be saved.",
                    "help_text": "Can be specified in params.yaml or via --outdir flag. Default is ./results",
                    "default": "./results",
                    "fa_icon": "fas fa-folder-open"
                },
                "email": {
                    "type": "string",
                    "description": "Email address for completion summary.",
                    "help_text": "Set this parameter to your e-mail address to get a summary e-mail with details of the run sent to you when the workflow exits.",
                    "pattern": "^([a-zA-Z0-9_\\-\\.]+)@([a-zA-Z0-9_\\-\\.]+)\\.([a-zA-Z]{2,5})$",
                    "fa_icon": "fas fa-envelope"
                }
            }
        },
        "reference_genome_options": {
            "title": "Reference genome options",
            "type": "object",
            "description": "Reference genome related files and options required for the workflow.",
            "properties": {
                "fasta": {
                    "type": "string",
                    "format": "file-path",
                    "description": "Path to reference genome FASTA file (GRCh37 or GRCh38).",
                    "help_text": "Human reference genome FASTA file. Choose between GRCh37 (hs37) or GRCh38 (hs38) to match your array data and PAR coordinates.",
                    "pattern": "^\\S+\\.fn?a(sta)?(\\.gz)?$",
                    "fa_icon": "fas fa-dna"
                }
            }
        },
        "quality_control_options": {
            "title": "Quality Control options",
            "type": "object",
            "description": "Parameters for quality control and filtering of SNP data.",
            "properties": {
                "het_up_as": {
                    "type": "number",
                    "description": "Upper heterozygosity threshold for autosomal SNPs.",
                    "default": 0.9,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "fas fa-chart-line"
                },
                "het_low_as": {
                    "type": "number",
                    "description": "Lower heterozygosity threshold for autosomal SNPs.",
                    "default": -0.9,
                    "minimum": -1,
                    "maximum": 1,
                    "fa_icon": "fas fa-chart-line"
                },
                "clust_sep_as": {
                    "type": "number",
                    "description": "Cluster separation threshold for autosomal SNPs.",
                    "default": 0.3,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "fas fa-object-group"
                },
                "MAF_as": {
                    "type": "number",
                    "description": "Minor allele frequency threshold for autosomal SNPs.",
                    "default": 0,
                    "minimum": 0,
                    "maximum": 0.5,
                    "fa_icon": "fas fa-percentage"
                },
                "hetexcess_quality_threshold": {
                    "type": "number",
                    "description": "Clonal/inbred sample detection threshold (% of SNPs with HetExcess > 0.95).",
                    "help_text": "Percentage threshold to flag samples as clonal or inbred based on HetExcess pattern. Higher values indicate related samples that may affect GenomeStudio clustering.",
                    "default": 20.0,
                    "minimum": 0,
                    "maximum": 100,
                    "fa_icon": "fas fa-dna"
                }
            }
        },
        "cnv_analysis_options": {
            "title": "CNV Analysis options",
            "type": "object",
            "description": "Parameters for copy number variation analysis.",
            "properties": {
                "excluded_chr": {
                    "type": "string",
                    "description": "Chromosomes to exclude from analysis.",
                    "default": "0,25,26"
                },
                "cnv_p_threshold": {
                    "type": "number",
                    "description": "CNV probability threshold for calling copy number variants.",
                    "help_text": "Minimum probability threshold for identifying copy number variants. Higher values are more stringent.",
                    "default": 0.9,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "fas fa-chart-line"
                },
                "baf_threshold": {
                    "type": "number",
                    "description": "B-allele frequency threshold for heterozygous calls.",
                    "help_text": "Threshold for B-allele frequency used in copy number analysis and loss of heterozygosity detection.",
                    "default": 0.2,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "fas fa-balance-scale"
                },
                "lrr_min": {
                    "type": "number",
                    "description": "Minimum Log R Ratio value for analysis.",
                    "help_text": "Lower bound for Log R Ratio values. Values below this threshold may indicate deletions.",
                    "default": -0.4,
                    "fa_icon": "fas fa-arrow-down"
                },
                "lrr_max": {
                    "type": "number",
                    "description": "Maximum Log R Ratio value for analysis.",
                    "help_text": "Upper bound for Log R Ratio values. Values above this threshold may indicate duplications.",
                    "default": 0.3,
                    "fa_icon": "fas fa-arrow-up"
                },
                "weight_lrr": {
                    "type": "number",
                    "description": "Weight parameter for LRR in copy number calling.",
                    "help_text": "Relative weight given to Log R Ratio values in the copy number analysis algorithm.",
                    "default": 0.2,
                    "minimum": 0,
                    "maximum": 1,
                    "fa_icon": "fas fa-weight"
                }
            }
        },
        "max_job_request_options": {
            "title": "Max job request options",
            "type": "object",
            "description": "Set the top limit for requested resources for any single job.",
            "properties": {
                "max_cpus": {
                    "type": "integer",
                    "description": "Maximum number of CPUs that can be requested for any single job.",
                    "default": 16,
                    "minimum": 1
                },
                "max_memory": {
                    "type": "string",
                    "description": "Maximum amount of memory that can be requested for any single job.",
                    "default": "128.GB",
                    "pattern": "^\\d+(\\.\\d+)?\\.?\\s*(K|M|G|T)?B$"
                },
                "max_time": {
                    "type": "string",
                    "description": "Maximum amount of time that can be requested for any single job.",
                    "default": "240.h",
                    "pattern": "^(\\d+\\.?\\s*(s|m|h|d|day)\\s*)+$"
                }
            }
        },
        "generic_options": {
            "title": "Generic options",
            "type": "object",
            "description": "Less common options for the pipeline.",
            "properties": {
                "help": {
                    "type": "boolean",
                    "description": "Display help text."
                },
                "show_version": {
                    "type": "boolean",
                    "description": "Display version and exit."
                },
                "publish_dir_mode": {
                    "type": "string",
                    "default": "copy",
                    "description": "Method used to save pipeline results to output directory.",
                    "enum": ["symlink", "rellink", "link", "copy", "copyNoFollow", "move"]
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/input_output_options"
        },
        {
            "$ref": "#/definitions/reference_genome_options"
        },
        {
            "$ref": "#/definitions/quality_control_options"
        },
        {
            "$ref": "#/definitions/cnv_analysis_options"
        },
        {
            "$ref": "#/definitions/max_job_request_options"
        },
        {
            "$ref": "#/definitions/generic_options"
        }
    ]
}